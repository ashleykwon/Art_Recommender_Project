<!DOCTYPE html>
<html>

<head>
    <title> Artrecs </title>
    <link rel="stylesheet" type="text/css" href="css/upload_art.css">

    <!--Fonts-->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet">

    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat+Alternates:wght@100;300&family=Montserrat:ital,wght@0,100;1,500&display=swap"
        rel="stylesheet">

    <link href="https://fonts.googleapis.com/css2?family=Teko:wght@300&display=swap" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css2?family=Sansita+Swashed:wght@700&display=swap" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">

    <link href="https://fonts.googleapis.com/css2?family=Open+Sans+Condensed:ital,wght@0,700;1,300&display=swap"
        rel="stylesheet">

    <link href="https://fonts.googleapis.com/css2?family=Acme&display=swap" rel="stylesheet">

    <script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-storage.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-analytics.js"></script>

</head>

<body>
    <script src="firebase.js"></script>
    <script src="index.js"></script>

    <div class="page_container">
        <header>
            <div class="header_container">
                <!--Website name-->
                <h2 class="logo" id="logo"><span>ART</span>RECS</h2>

                <!--Navegation menu-->
                <nav>
                    <a href="home_registered_user.html" id="home_button">Home</a>
                    <a href="my_artworks.html" id="my_artworks_button">My Artworks</a>
                    <a href="my_library.html" id="my_library_button">My Library</a>
                    <a href="home_unregistered_user.html" id="log_out_button">Log Out</a>
                </nav>
            </div>
        </header>

        <!--MAIN-->
        <div class="main">
            <div class="main_container">
                <div class="upload_window_container">
                    <div class="artwork_info">
                        Artist Name: <input type="text" id="name"></input> <br>
                        Artwork Title: <input type="text" id="title"></input> <br>
                        Creation year: <input type="text" id="year"></input> <br>
                        Description: <input type="text" id="description"></input> <br>
                    </div>

                    <br><br>

                    <style>
                        img {
                            height: 200px;
                            width: 200px;
                            border: 2pm solid white;
                        }
                    </style>
                    <img id="myimg" input type="hidden"> <label id="UpProgress"></label>

                    <br><br>

                    <button id="select_img"> Select Image </button>
                </div>

                <div class="questionnaire part">
                    <div class = "titles">How would you characterize your artwork? </div>
                    <div class="questionnaire_container"> 
                        <div class="question_container">
                            <div class="question">How colorful is your artwork?</div>
                            <div class="slide_container">
                                <input type="range" min="1" max="100" value="50" class="questionnaire_slider" id="slider1">
                                <p class="slider_value"><span id="demo1"></span></p>
                            </div>
                            <script>
                                var slider1 = document.getElementById("slider1");
                                var output1 = document.getElementById("demo1");
                                output1.innerHTML = slider1.value;

                                slider1.oninput = function () {
                                    output1.innerHTML = this.value;
                                }
                            </script>
                        </div>
                        <div class="question_container">
                            <div class="question">Is your artwork more abstract(1) or realistic (100)?</div>
                            <div class="slide_container">
                                <input type="range" min="1" max="100" value="50" class="questionnaire_slider" id="slider2">
                                <p class="slider_value"><span id="demo2"></span></p>
                            </div>
                            <script>
                                var slider2 = document.getElementById("slider2");
                                var output2 = document.getElementById("demo2");
                                output2.innerHTML = slider2.value;

                                slider2.oninput = function () {
                                    output2.innerHTML = this.value;
                                }
                            </script>
                        </div>
                        <div class="question_container">
                            <div class="question">Is your artwork more minimalistic(1) or extravagant (100)?</div>
                            <div class="slide_container">
                                <input type="range" min="1" max="100" value="50" class="questionnaire_slider" id="slider3">
                                <p class="slider_value"><span id="demo3"></span></p>
                            </div>
                            <script>
                                var slider3 = document.getElementById("slider3");
                                var output3 = document.getElementById("demo3");
                                output3.innerHTML = slider3.value;

                                slider3.oninput = function () {
                                    output3.innerHTML = this.value;
                                }
                            </script>
                        </div>
                        <div class="question_container">
                            <div class="question">How much time did you spend to create your artwork with 1 being less than a month and 100 being more than 5 years?</div>
                            <div class="slide_container">
                                <input type="range" min="1" max="100" value="50" class="questionnaire_slider" id="slider4">
                                <p class="slider_value"><span id="demo4"></span></p>
                            </div>
                            <script>
                                var slider4 = document.getElementById("slider4");
                                var output4 = document.getElementById("demo4");
                                output4.innerHTML = slider4.value;

                                slider4.oninput = function () {
                                    output4.innerHTML = this.value;
                                }
                            </script>
                        </div>
                        <div class="question_container">
                            <div class="question">How much is your artwork related to your personal experiences?</div>
                            <div class="slide_container">
                                <input type="range" min="1" max="100" value="50" class="questionnaire_slider" id="slider5">
                                <p class="slider_value"><span id="demo5"></span></p>
                            </div>
                            <script>
                                var slider5 = document.getElementById("slider5");
                                var output5 = document.getElementById("demo5");
                                output5.innerHTML = slider5.value;

                                slider5.oninput = function () {
                                    output5.innerHTML = this.value;
                                }
                            </script>
                        </div>
                        <div class="question_container">
                            <div class="question">When you are creating your artwork, how much inspiration did you draw from older artworks, histories, and mythologies?</div>
                            <div class="slide_container">
                                <input type="range" min="1" max="100" value="50" class="questionnaire_slider" id="slider6">
                                <p class="slider_value"><span id="demo6"></span></p>
                            </div>
                            <script>
                                var slider6 = document.getElementById("slider6");
                                var output6 = document.getElementById("demo6");
                                output6.innerHTML = slider6.value;

                                slider6.oninput = function () {
                                    output6.innerHTML = this.value;
                                }
                            </script>
                        </div>
                        <div class="question_container">
                            <div class="question">How much is your artwork be related to social issues (e.g. migration, gender, environment â€¦ etc.)?</div>
                            <div class="slide_container">
                                <input type="range" min="1" max="100" value="50" class="questionnaire_slider" id="slider7">
                                <p class="slider_value"><span id="demo7"></span></p>
                            </div>
                            <script>
                                var slider7 = document.getElementById("slider7");
                                var output7 = document.getElementById("demo7");
                                output7.innerHTML = slider7.value;

                                slider7.oninput = function () {
                                    output7.innerHTML = this.value;
                                }
                            </script>
                        </div>
                        <div class="question_container">
                            <div class="question">How thought-provoking is your artwork?</div>
                            <div class="slide_container">
                                <input type="range" min="1" max="100" value="50" class="questionnaire_slider" id="slider8">
                                <p class="slider_value"><span id="demo8"></span></p>
                            </div>
                            <script>
                                var slider8 = document.getElementById("slider8");
                                var output8 = document.getElementById("demo8");
                                output8.innerHTML = slider8.value;

                                slider8.oninput = function () {
                                    output8.innerHTML = this.value;
                                }
                            </script>
                        </div>
                        <div class="question_container">
                            <div class="question">How much room for interpretation does your artwork leave to viewers?</div>
                            <div class="slide_container">
                                <input type="range" min="1" max="100" value="50" class="questionnaire_slider" id="slider9">
                                <p class="slider_value"><span id="demo9"></span></p>
                            </div>
                            <script>
                                var slider9 = document.getElementById("slider9");
                                var output9 = document.getElementById("demo9");
                                output9.innerHTML = slider9.value;

                                slider9.oninput = function () {
                                    output9.innerHTML = this.value;
                                }
                            </script>
                        </div>
                        <div class="question_container">
                            <div class="question">How likely is it for people to find your artwork in a museum of a gallery?</div>
                            <div class="slide_container">
                                <input type="range" min="1" max="100" value="50" class="questionnaire_slider" id="slider10">
                                <p class="slider_value"><span id="demo10"></span></p>
                            </div>
                            <script>
                                var slider10 = document.getElementById("slider10");
                                var output10 = document.getElementById("demo10");
                                output10.innerHTML = slider10.value;

                                slider10.oninput = function () {
                                    output10.innerHTML = this.value;
                                }
                            </script>
                        </div>
                    </div>
                </div>
                

                <div class="check_categories part">
                    <div class="titles">What categories does your artwork belong to?</div>
                    <div class="categories">
                        <div class="categories_container">
                            <div class="category">
                                <span>Architecture:</span>
                                <input class="checkbox" type="checkbox" id="architecture">
                            </div>
                            <div class="category">
                                <span>Calligraphy:</span>
                                <input class="checkbox" type="checkbox" id="calligraphy">
                            </div>
                            <div class="category">
                                <span>Painting:</span>
                                <input class="checkbox" type="checkbox" id="painting">
                            </div>
                            <div class="category">
                                <span>Photography:</span>
                                <input class="checkbox" type="checkbox" id="photography">
                            </div>
                            <div class="category">
                                <span>Pottery:</span>
                                <input class="checkbox" type="checkbox" id="pottery">
                            </div>
                            <div class="category">
                                <span>Sculpture:</span>
                                <input class="checkbox" type="checkbox" id="sculpture">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="button_container">
                    <button class="button" id="submit">Submit</button>
                </div>
            </div>
        </div>

        <!--FOOTER-->
        <footer>
            <div class=footer_container>
                <div class="footer_after_line">
                    <p class="social_connect">WRITE <span>to</span> US:</p>
                    <p class="artrecs_em">ðŸ“§artrec2020@gmail.com</p>
                </div>
            </div>
        </footer>
    </div>


    <!--background functions-->


    <script id="MainScript">

        var ref = firebase.database().ref('users');

        var nameV, titleV, yearV, descriptionV;
        var checkboxChoice = [];
        var sliderChoice = [];

        //for image upload
        var ImgName, ImgUrl;
        var files = [];
        var reader;

        function GetInputData() {
            nameV = document.getElementById("name").value;
            titleV = document.getElementById("title").value;
            yearV = document.getElementById("year").value;
            descriptionV = document.getElementById("description").value;

            var checked1 = document.getElementById("architecture").checked;
            var checked2 = document.getElementById("calligraphy").checked;
            var checked3 = document.getElementById("painting").checked;
            var checked4 = document.getElementById("photography").checked;
            var checked5 = document.getElementById("pottery").checked;
            var checked6 = document.getElementById("sculpture").checked;

            var choices = [checked1, checked2, checked3, checked4, checked5, checked6]
            var categories = ['architecture', 'calligraphy', 'painting', 'photography', 'pottery', 'sculpture']
            var nbOfChecks = 0;
            for (i = 0; i < choices.length; i++) {
                if (choices[i]) {
                    checkboxChoice.push(categories[i]);
                }
            }

            var sliderValue1 = document.getElementById("slider1").value;
            var sliderValue2 = document.getElementById("slider2").value;
            var sliderValue3 = document.getElementById("slider3").value;
            var sliderValue4 = document.getElementById("slider4").value;
            var sliderValue5 = document.getElementById("slider5").value;
            var sliderValue6 = document.getElementById("slider6").value;
            var sliderValue7 = document.getElementById("slider7").value;
            var sliderValue8 = document.getElementById("slider8").value;
            var sliderValue9 = document.getElementById("slider9").value;
            var sliderValue10 = document.getElementById("slider10").value;
            sliderChoice = [sliderValue1, sliderValue2, sliderValue3, sliderValue4, sliderValue5, sliderValue6, sliderValue7, sliderValue8, sliderValue9, sliderValue10];
        }


        firebase.auth().onAuthStateChanged(function (user) {
            if (user) {
                var userID = user.uid;

                //selects image
                document.getElementById("select_img").onclick = function (e) {
                    var input = document.createElement("input");
                    input.type = "file";

                    input.onchange = e => {
                        files = e.target.files;
                        reader = new FileReader();
                        reader.onload = function () {
                            document.getElementById("myimg").src = reader.result;
                        }
                        reader.readAsDataURL(files[0]);
                    }
                    input.click();
                }


                document.getElementById("submit").onclick = function () {
                    var userID = firebase.auth().currentUser.uid;
                    //console.log(userID);
                    var artworkID = Math.random().toString(36).substr(2, 9);

                    //fills in checkBoxChoice and SliderChoice
                    GetInputData();

                    firebase.database().ref("artworks/" + artworkID).set({
                        artworkID: artworkID,
                        artistName: nameV,
                        artworkTitle: titleV,
                        creationYear: yearV,
                        description: descriptionV,
                        fileLink: 'yyy',
                        categoryVec: checkboxChoice,
                        characVec: sliderChoice
                    })

                    var uploadedArtworks = firebase.database().ref("users/").child(userID).child("myArtworks");
                    uploadedArtworks.push({
                        artworkID
                    })

                    var uploadTask = firebase.storage().ref(artworkID + ".png").put(files[0]);
                    //console.log(uploadTask);

                    //shows upload progress after the user selects an image file to upload
                    uploadTask.on('state_changed', function (snapshot) {
                        var progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        document.getElementById("UpProgress").innerHTML = 'Upload: ' + progress + "%";
                    },
                        //error handlinng
                        function (error) {
                            console.log(error)
                            alert('Error in saving the image')
                        },

                        //submit image to database
                        function () {
                            uploadTask.snapshot.ref.getDownloadURL().then(function (url) {
                                ImgUrl = url;
                                //console.log(ImgUrl)
                                if (ImgUrl != "yyy"){
                                    firebase.database().ref('artworks/' + artworkID).update({
                                        fileLink: ImgUrl
                                    });
                                }

                                alert('Image uploaded successfully!');
                                location.href = 'my_artworks.html'
                            });
                        }
                        
                    );
                }

            } else {
                console.log('user not logged in')
            }
        });

    </script>

</body>

</html>